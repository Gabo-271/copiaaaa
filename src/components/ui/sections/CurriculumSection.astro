---
const semestres = [
    {
        numero: 1,
        asignaturas: [
            "Introducción a la Ingeniería en Informática",
            "Matemática I",
            "Fundamentos de Programación",
            "Comunicación Efectiva",
            "Inglés I"
        ]
    },
    {
        numero: 2,
        asignaturas: [
            "Matemática II",
            "Programación Orientada a Objetos",
            "Arquitectura de Computadores",
            "Álgebra Lineal",
            "Inglés II"
        ]
    },
    {
        numero: 3,
        asignaturas: [
            "Matemática III",
            "Estructura de Datos",
            "Sistemas Operativos",
            "Base de Datos",
            "Probabilidad y Estadística"
        ]
    },
    {
        numero: 4,
        asignaturas: [
            "Análisis de Algoritmos",
            "Programación de Sistemas",
            "Diseño de Base de Datos",
            "Redes de Computadores",
            "Inglés III"
        ]
    },
    {
        numero: 5,
        asignaturas: [
            "Ingeniería de Software I",
            "Desarrollo de Aplicaciones Web",
            "Sistemas Distribuidos",
            "Inteligencia Artificial",
            "Gestión de Proyectos TI"
        ]
    },
    {
        numero: 6,
        asignaturas: [
            "Ingeniería de Software II",
            "Desarrollo de Aplicaciones Móviles",
            "Seguridad Informática",
            "Machine Learning",
            "Emprendimiento e Innovación"
        ]
    },
    {
        numero: 7,
        asignaturas: [
            "Arquitectura de Software",
            "Cloud Computing",
            "Big Data y Analytics",
            "Electivo I",
            "Práctica Profesional"
        ]
    },
    {
        numero: 8,
        asignaturas: [
            "Calidad de Software",
            "DevOps y CI/CD",
            "Ética Profesional",
            "Electivo II",
            "Proyecto de Título"
        ]
    }
];
---

<style>
    .carousel-container {
        position: relative;
        overflow: hidden;
        width: 100%;
    }
    
    .carousel-track {
        display: flex;
        transition: transform 0.5s ease-in-out;
        width: 100%;
    }
    
    .carousel-item {
        min-width: 100%;
        width: 100%;
        flex-shrink: 0;
        padding: 0 1rem;
        box-sizing: border-box;
    }
    
    .carousel-item-inner {
        width: 100%;
        max-width: 100%;
        margin: 0 auto;
    }
    
    .carousel-dots {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-top: 1.5rem;
    }
    
    .carousel-dot {
        width: 0.5rem;
        height: 0.5rem;
        border-radius: 50%;
        background-color: #d1d5db;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        padding: 0;
    }
    
    .carousel-dot.active {
        background-color: #3b82f6;
        width: 1.5rem;
        border-radius: 0.25rem;
    }
    
    .dark .carousel-dot {
        background-color: #4b5563;
    }
    
    .dark .carousel-dot.active {
        background-color: #60a5fa;
    }
    
    .carousel-nav-button {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        background-color: transparent;
        color: #ffffff;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        z-index: 10;
    }
    
    .carousel-nav-button:hover {
        color: #3b82f6;
        transform: translateY(-50%) scale(1.2);
    }
    
    .carousel-nav-button:disabled {
        opacity: 0.3;
        cursor: not-allowed;
    }
    
    .carousel-nav-button:disabled:hover {
        color: #ffffff;
        transform: translateY(-50%);
    }
    
    .carousel-nav-button.prev {
        left: -1.5rem;
    }
    
    .carousel-nav-button.next {
        right: -1.5rem;
    }
    
    .dark .carousel-nav-button {
        color: #ffffff;
    }
    
    .dark .carousel-nav-button:hover {
        color: #60a5fa;
    }
    
    .dark .carousel-nav-button:disabled:hover {
        color: #ffffff;
    }
    
    @media (min-width: 768px) {
        .carousel-container {
            overflow: visible;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }
        
        .carousel-nav-button {
            display: none;
        }
        
        .carousel-track {
            display: contents;
        }
        
        .carousel-item {
            min-width: auto;
            width: auto;
            padding: 0;
        }
        
        .carousel-dots {
            display: none;
        }
    }
    
    @media (min-width: 1024px) {
        .carousel-container {
            grid-template-columns: repeat(4, 1fr);
        }
    }
</style>

<section id="curriculum" class="bg-neutral-100 dark:bg-neutral-900/50 py-10 lg:py-14 scroll-mt-20">
    <div class="mx-auto max-w-[85rem] px-4 sm:px-6 lg:px-8 2xl:max-w-full">
        <div class="mx-auto max-w-2xl text-center mb-10 lg:mb-14">
            <h2 class="text-3xl font-bold text-neutral-800 dark:text-neutral-200 md:text-4xl md:leading-tight">
                Malla Curricular
            </h2>
            <p class="mt-4 text-pretty text-neutral-600 dark:text-neutral-400">
                Plan de estudios por semestre - 8 semestres (4 años)
            </p>
        </div>

        <!-- Carrusel para móvil, Grid para desktop -->
        <div class="relative max-w-7xl mx-auto">
            <!-- Botón anterior -->
            <button class="carousel-nav-button prev md:hidden" aria-label="Anterior">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="15 18 9 12 15 6"/>
                </svg>
            </button>
            
            <!-- Botón siguiente -->
            <button class="carousel-nav-button next md:hidden" aria-label="Siguiente">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="9 18 15 12 9 6"/>
                </svg>
            </button>
            
            <div class="carousel-container">
                <div class="carousel-track">
                {semestres.map((semestre) => (
                    <div class="carousel-item">
                        <div class="carousel-item-inner bg-white dark:bg-white rounded-xl p-6 shadow-sm hover:shadow-lg transition-all hover:-translate-y-1">
                            <div class="flex items-center justify-center size-14 bg-gradient-to-br from-blue-500 to-green-500 rounded-lg mb-4 mx-auto">
                                <span class="text-2xl font-bold text-white">{semestre.numero}</span>
                            </div>
                            <h3 class="text-lg font-bold text-center text-neutral-800 dark:text-neutral-800 mb-4">
                                Semestre {semestre.numero}
                            </h3>
                            <ul class="space-y-2 text-sm text-neutral-600 dark:text-neutral-700">
                                {semestre.asignaturas.map((asignatura) => (
                                    <li class="flex items-start">
                                        <svg class="size-4 text-green-500 dark:text-green-600 mt-0.5 mr-2 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="20 6 9 17 4 12"/>
                                        </svg>
                                        <span class="break-words">{asignatura}</span>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    </div>
                ))}
                </div>
            </div>
        </div>
        
        <!-- Indicadores del carrusel (solo móvil) -->
        <div class="carousel-dots md:hidden">
            {semestres.map((_, index) => (
                <button 
                    class={`carousel-dot ${index === 0 ? 'active' : ''}`}
                    data-index={index}
                    aria-label={`Ir al semestre ${index + 1}`}
                ></button>
            ))}
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const section = document.querySelector('#curriculum');
        if (!section) return;
        
        const container = section.querySelector('.carousel-container');
        const track = section.querySelector('.carousel-track');
        const dots = section.querySelectorAll('.carousel-dot');
        const items = section.querySelectorAll('.carousel-item');
        const prevButton = section.querySelector('.carousel-nav-button.prev');
        const nextButton = section.querySelector('.carousel-nav-button.next');
        
        let currentIndex = 0;
        let startX = 0;
        let currentX = 0;
        let isDragging = false;

        const isMobile = () => window.innerWidth < 768;

        const updateCarousel = (index: number) => {
            if (!isMobile()) return;
            
            currentIndex = Math.max(0, Math.min(index, items.length - 1));
            const offset = -currentIndex * 100;
            (track as HTMLElement).style.transform = `translateX(${offset}%)`;
            
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === currentIndex);
            });
            
            // Actualizar estado de los botones
            if (prevButton) {
                (prevButton as HTMLButtonElement).disabled = currentIndex === 0;
            }
            if (nextButton) {
                (nextButton as HTMLButtonElement).disabled = currentIndex === items.length - 1;
            }
        };

        // Click en los dots
        dots.forEach((dot, index) => {
            dot.addEventListener('click', () => {
                updateCarousel(index);
            });
        });
        
        // Click en los botones de navegación
        prevButton?.addEventListener('click', () => {
            if (currentIndex > 0) {
                updateCarousel(currentIndex - 1);
            }
        });
        
        nextButton?.addEventListener('click', () => {
            if (currentIndex < items.length - 1) {
                updateCarousel(currentIndex + 1);
            }
        });

        // Soporte táctil (swipe)
        const handleTouchStart = (e: Event) => {
            if (!isMobile()) return;
            const touchEvent = e as TouchEvent;
            startX = touchEvent.touches[0].clientX;
            isDragging = true;
            if (track) (track as HTMLElement).style.transition = 'none';
        };

        const handleTouchMove = (e: Event) => {
            if (!isDragging || !isMobile()) return;
            const touchEvent = e as TouchEvent;
            currentX = touchEvent.touches[0].clientX;
            const diff = currentX - startX;
            const offset = -currentIndex * 100 + (diff / window.innerWidth) * 100;
            if (track) (track as HTMLElement).style.transform = `translateX(${offset}%)`;
        };

        const handleTouchEnd = () => {
            if (!isDragging || !isMobile()) return;
            isDragging = false;
            if (track) (track as HTMLElement).style.transition = 'transform 0.5s ease-in-out';
            
            const diff = startX - currentX;
            const threshold = 50;
            
            if (Math.abs(diff) > threshold) {
                if (diff > 0 && currentIndex < items.length - 1) {
                    updateCarousel(currentIndex + 1);
                } else if (diff < 0 && currentIndex > 0) {
                    updateCarousel(currentIndex - 1);
                } else {
                    updateCarousel(currentIndex);
                }
            } else {
                updateCarousel(currentIndex);
            }
        };

        // Soporte para mouse (desktop)
        const handleMouseDown = (e: Event) => {
            if (!isMobile()) return;
            const mouseEvent = e as MouseEvent;
            startX = mouseEvent.clientX;
            isDragging = true;
            if (track) (track as HTMLElement).style.transition = 'none';
        };

        const handleMouseMove = (e: Event) => {
            if (!isDragging || !isMobile()) return;
            const mouseEvent = e as MouseEvent;
            currentX = mouseEvent.clientX;
            const diff = currentX - startX;
            const offset = -currentIndex * 100 + (diff / window.innerWidth) * 100;
            if (track) (track as HTMLElement).style.transform = `translateX(${offset}%)`;
        };

        const handleMouseUp = () => {
            if (!isDragging || !isMobile()) return;
            handleTouchEnd();
        };

        // Event listeners
        track?.addEventListener('touchstart', handleTouchStart as EventListener, { passive: true });
        track?.addEventListener('touchmove', handleTouchMove as EventListener, { passive: true });
        track?.addEventListener('touchend', handleTouchEnd);
        
        track?.addEventListener('mousedown', handleMouseDown as EventListener);
        document.addEventListener('mousemove', handleMouseMove as EventListener);
        document.addEventListener('mouseup', handleMouseUp);

        // Ajustar al cambiar tamaño de ventana
        let resizeTimeout: ReturnType<typeof setTimeout>;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (!isMobile()) {
                    (track as HTMLElement).style.transform = 'translateX(0)';
                    (track as HTMLElement).style.transition = '';
                    dots.forEach(dot => dot.classList.remove('active'));
                } else {
                    updateCarousel(currentIndex);
                }
            }, 100);
        });

        // Inicializar
        if (isMobile()) {
            updateCarousel(0);
        } else {
            // Asegurar que en desktop todos los dots estén inactivos
            dots.forEach(dot => dot.classList.remove('active'));
        }
    });
</script>
